#!/bin/bash

echo """
   _______      ________    ___   ___ ___  ____       ____    __   ___  _  _   _____ 
  / ____\ \    / /  ____|  |__ \ / _ \__ \|___ \     |___ \  / /  / _ \| || | | ____|
 | |     \ \  / /| |__ ______ ) | | | | ) | __) |_____ __) |/ /_ | (_) | || |_| |__  
 | |      \ \/ / |  __|______/ /| | | |/ / |__ <______|__ <| '_ \ > _ <|__   _|___ \ 
 | |____   \  /  | |____    / /_| |_| / /_ ___) |     ___) | (_) | (_) |  | |  ___) |
  \_____|   \/   |______|  |____|\___/____|____/     |____/ \___/ \___/   |_| |____/ 
                                                                  by e11i0t_4lders0n
  """                                                                                   

# Function to display usage information
usage() {
    echo "Usage: $0 <domain>"
    echo "Example: $0 example.com"
    exit 1
}

# Ask the user for the domain
read -p "Enter the domain: " domain

# Check if a domain is provided
if [ -z "$domain" ]; then
    usage
fi

# Check if Shodan API key is configured
if [ -z "$SHODAN_API_KEY" ]; then
    echo "Error: Shodan API key is not configured. Please set the SHODAN_API_KEY environment variable."
    exit 1
fi

# Get Juniper Web Device Manager IPs from Shodan
echo "[*] Fetching Juniper Web Device Manager IPs from Shodan for domain: $domain"
shodan parse --fields ip_str "product:Juniper Web Device Manager" "hostname:*.$domain" | awk -F '"' '{print $4}' > juniper_ips.txt

# Check if any IPs are found
if [ ! -s juniper_ips.txt ]; then
    echo "[!] No Juniper Web Device Manager IPs found for domain: $domain"
    exit 1
fi

# Run httpx on the IPs
echo "[*] Running httpx on Juniper Web Device Manager IPs"
httpx -l juniper_ips.txt -silent > juniper_urls.txt

# Run nuclei with CVE-2023-36845
echo "[*] Running nuclei with CVE-2023-36845 on Juniper Web Device Manager URLs"
nuclei -l juniper_urls.txt -t cves/CVE-2023-36845.yaml -severity critical

echo "[*] Script execution complete."
